<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
    
    <entry>
      <title><![CDATA[在 CentOS 6 安裝、設定 Oracel PDO_OCI]]></title>
      <url>https://blog.dtask.idv.tw/CentOS/oracle_pdo_oci_in_centos_6/</url>
      <content type="html"><![CDATA[<h1 id="下載檔案"><a href="#下載檔案" class="headerlink" title="下載檔案"></a>下載檔案</h1><p><img src="14733272698815.jpg" alt=""></p>
<h2 id="Oracle-Instant-Client"><a href="#Oracle-Instant-Client" class="headerlink" title="Oracle Instant Client"></a>Oracle Instant Client</h2><ul>
<li>32bit → <a href="http://www.oracle.com/technetwork/topics/linuxsoft-082809.html" target="_blank" rel="external">http://www.oracle.com/technetwork/topics/linuxsoft-082809.html</a></li>
<li>64bit → <a href="http://www.oracle.com/technetwork/topics/linuxx86-64soft-092277.html" target="_blank" rel="external">http://www.oracle.com/technetwork/topics/linuxx86-64soft-092277.html</a></li>
</ul>
<h2 id="oci8"><a href="#oci8" class="headerlink" title="oci8"></a>oci8</h2><p><a href="http://pecl.php.net/package/oci8" target="_blank" rel="external">http://pecl.php.net/package/oci8</a></p>
<h2 id="PDO-OCI"><a href="#PDO-OCI" class="headerlink" title="PDO_OCI"></a>PDO_OCI</h2><p><a href="https://pecl.php.net/package/pdo_oci" target="_blank" rel="external">https://pecl.php.net/package/pdo_oci</a></p>
<a id="more"></a>
<h1 id="安裝套件"><a href="#安裝套件" class="headerlink" title="安裝套件"></a>安裝套件</h1><h2 id="先安裝編譯套件"><a href="#先安裝編譯套件" class="headerlink" title="先安裝編譯套件"></a>先安裝編譯套件</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">yum --enablerepo=remi-php56 install php-devel</div></pre></td></tr></table></figure>
<p>or</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">yum install php-devel</div></pre></td></tr></table></figure>
<h2 id="Oracle-Instant-Client-1"><a href="#Oracle-Instant-Client-1" class="headerlink" title="Oracle Instant Client"></a>Oracle Instant Client</h2><h3 id="安裝"><a href="#安裝" class="headerlink" title="安裝"></a>安裝</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">rpm -ivh oracle-instantclient11.2-basic-11.2.0.4.0-1.i386.rpm</div><div class="line">rpm -ivh oracle-instantclient11.2-devel-11.2.0.4.0-1.i386.rpm</div></pre></td></tr></table></figure>
<p>確認</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">rpm -qa | grep oracle</div></pre></td></tr></table></figure>
<h3 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">vi /etc/ld.so.conf</div></pre></td></tr></table></figure>
<p>最後一行加上</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">/usr/lib/oracle/11.2/client/lib/</div></pre></td></tr></table></figure>
<p>如為 64bit 版本的則改為 client64，以下全都是</p>
<h4 id="設定-link"><a href="#設定-link" class="headerlink" title="設定 link"></a>設定 link</h4><p>64bit 版本需再設定 link</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">ln -s /usr/lib/oracle/11.2/client64 /usr/lib/oracle/11.2/client</div><div class="line">ln -s /usr/include/oracle/11.2/client64 /usr/include/oracle/11.2/client</div></pre></td></tr></table></figure>
<h3 id="環境變數"><a href="#環境變數" class="headerlink" title="環境變數"></a>環境變數</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">vi /etc/profile</div></pre></td></tr></table></figure>
<p>最後加入</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">export ORACLE_HOME=/usr/lib/oracle/11.2/client/</div><div class="line">export LD_LIBRARY_PATH=/usr/lib/oracle/11.2/client:$LD_LIBRARY_PATH</div><div class="line">export NLS_LANG=&quot;AMERICAN_AMERICA.AL32UTF8&quot;</div></pre></td></tr></table></figure>
<p>讀取設定</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">source /etc/profile</div></pre></td></tr></table></figure>
<h2 id="oci8-1"><a href="#oci8-1" class="headerlink" title="oci8"></a>oci8</h2><h3 id="先安裝-DTRACE"><a href="#先安裝-DTRACE" class="headerlink" title="先安裝 DTRACE"></a>先安裝 DTRACE</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">yum install systemtap-sdt-devel</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">vi /etc/profile</div></pre></td></tr></table></figure>
<p>最後一行加上</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">export PHP_DTRACE=yes</div></pre></td></tr></table></figure>
<p>讀取設定</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">source /etc/profile</div></pre></td></tr></table></figure>
<h3 id="編譯安裝"><a href="#編譯安裝" class="headerlink" title="編譯安裝"></a>編譯安裝</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">tar -zxvf oci8-2.0.12.tgz</div><div class="line">cd oci8-2.0.12</div><div class="line">phpize</div><div class="line">./configure --with-oci8=shared,instantclient,/usr/lib/oracle/11.2/client/lib</div><div class="line">make</div><div class="line">make install</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Installing shared extensions:     /usr/lib/php/modules/</div></pre></td></tr></table></figure>
<h3 id="配置-1"><a href="#配置-1" class="headerlink" title="配置"></a>配置</h3><p>建立 ini</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">vi /etc/php.d/20-oci8.ini</div></pre></td></tr></table></figure>
<p>加入</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">extension=oci8.so</div></pre></td></tr></table></figure>
<p>存檔，查詢</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">php -i | grep oci8</div></pre></td></tr></table></figure>
<h2 id="PDO-OCI-1"><a href="#PDO-OCI-1" class="headerlink" title="PDO_OCI"></a>PDO_OCI</h2><h3 id="修改-source-code"><a href="#修改-source-code" class="headerlink" title="修改 source code"></a>修改 source code</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">tar -zxvf PDO_OCI-1.0.tgz</div><div class="line">cd PDO_OCI-1.0</div></pre></td></tr></table></figure>
<h4 id="修改-config-m4"><a href="#修改-config-m4" class="headerlink" title="修改 config.m4"></a>修改 config.m4</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">vi config.m4</div></pre></td></tr></table></figure>
<p>第 10~11 行</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">elif test -f $PDO_OCI_DIR/lib/libclntsh.$SHLIB_SUFFIX_NAME.10.1; then</div><div class="line">  PDO_OCI_VERSION=10.1</div></pre></td></tr></table></figure>
<p>復制改為 11.2</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">elif test -f $PDO_OCI_DIR/lib/libclntsh.$SHLIB_SUFFIX_NAME.11.2; then</div><div class="line">  PDO_OCI_VERSION=11.2</div></pre></td></tr></table></figure>
<p>第 121~123 行</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">10.2)</div><div class="line">  PHP_ADD_LIBRARY(clntsh, 1, PDO_OCI_SHARED_LIBADD)</div><div class="line">  ;;</div></pre></td></tr></table></figure>
<p>復制改為 11.2</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">11.2)</div><div class="line">  PHP_ADD_LIBRARY(clntsh, 1, PDO_OCI_SHARED_LIBADD)</div><div class="line">  ;;</div></pre></td></tr></table></figure>
<p>存檔</p>
<h4 id="修改-pdo-oci-c"><a href="#修改-pdo-oci-c" class="headerlink" title="修改 pdo_oci.c"></a>修改 pdo_oci.c</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">vi pdo_oci.c</div></pre></td></tr></table></figure>
<p>第 34~36 行</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">function_entry pdo_oci_functions[] = &#123;</div><div class="line">    &#123;NULL, NULL, NULL&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>改為</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">zend_function_entry pdo_oci_functions[] = &#123;</div><div class="line">    &#123;NULL, NULL, NULL&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="編譯安裝-1"><a href="#編譯安裝-1" class="headerlink" title="編譯安裝"></a>編譯安裝</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">phpize</div><div class="line">./configure --with-pdo-oci=instantclient,/usr,11.2</div><div class="line">make</div><div class="line">make install</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Installing shared extensions:     /usr/lib/php/modules/</div></pre></td></tr></table></figure>
<h3 id="配置-2"><a href="#配置-2" class="headerlink" title="配置"></a>配置</h3><p>建立 ini</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">vi /etc/php.d/30-pdo_oci.ini</div></pre></td></tr></table></figure>
<p>加入</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">extension=pdo_oci.so</div></pre></td></tr></table></figure>
<p>存檔，查詢</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">php -i | grep oci</div></pre></td></tr></table></figure>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[SourceTree - Custom Actioins]]></title>
      <url>https://blog.dtask.idv.tw/Git/SourceTree-CustomActioins/</url>
      <content type="html"><![CDATA[<p>SourceTree 提供 Custom Actions 的功能<br>讓 User 可以自訂語法或寫 Shell Script 來執行<br>目前自己寫了三個 Shell Script</p>
<a id="more"></a>
<h1 id="備份-git"><a href="#備份-git" class="headerlink" title="備份 .git"></a>備份 .git</h1><h2 id="Script"><a href="#Script" class="headerlink" title="Script"></a>Script</h2><p>目的是將 project 底下的 .git 備份出去</p>
<blockquote>
<p>有時會想要測試一些 git 指令，卻又怕把 repo 搞亂、搞壞<br>所以可以先把 .git 備份起來</p>
</blockquote>
<p><strong>語法裡有使用 rm -rf 指令，請小心使用</strong><br><strong>語法裡有使用 rm -rf 指令，請小心使用</strong><br><strong>語法裡有使用 rm -rf 指令，請小心使用</strong></p>
<p>檔案路徑：~/SourceTree_Actions/backupGitFolder.sh</p>
<p><code>$1 → 在 SourceTree 使用時，設定讓它帶入 repo path，為了區別不同 product 下的 .git</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">#!/bin/sh</div><div class="line"></div><div class="line"># 設定備份路徑</div><div class="line">backupPath=~/Downloads/backupGit/</div><div class="line"></div><div class="line"># 取得目錄名稱</div><div class="line">folderName=`basename $1`</div><div class="line"></div><div class="line"># 將目錄剛整路徑 MD5</div><div class="line">folderNameSHA=`md5 &lt;&lt;&lt; &quot;$1&quot;`</div><div class="line"></div><div class="line"># 組合備份目錄名稱</div><div class="line">backupFolderName=&quot;$&#123;folderName&#125;__$&#123;folderNameSHA&#125;__git&quot;</div><div class="line"></div><div class="line"># 刪除原備份目錄</div><div class="line">rm -rf $&#123;backupPath&#125;$&#123;backupFolderName&#125;</div><div class="line"></div><div class="line"># 將 .git copy 出去</div><div class="line">cp -rf ./.git $&#123;backupPath&#125;$&#123;backupFolderName&#125;</div></pre></td></tr></table></figure>
<h2 id="使用方式"><a href="#使用方式" class="headerlink" title="使用方式"></a>使用方式</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">建議再第一次使用時，先手動將 .git 備份出去，避免設定上出問題導至 .git 完全不見且沒備份到</div></pre></td></tr></table></figure>
<p>開啟設定介面 SourceTree → Preferences 或 快速鍵 <code>CMD + ,</code></p>
<p><img src="14715694646486.jpg" alt=""></p>
<p>切換至 Custom Actions<br>新增 Add</p>
<p><img src="14715695027809.jpg" alt=""></p>
<p>Menu Caption → <code>backupGitFolder</code> (自訂)<br>Script to run → <code>bash</code> (使用 bash 來執行 script)<br>Parameters → <code>/SourceTree_Actions/backupGitFolder.sh $REPO</code> script 路徑，且帶入參數 $REPO</p>
<p><img src="14715711110247.jpg" alt=""></p>
<p>新增完後會看到剛新增的項目</p>
<p><img src="14715695838811.jpg" alt=""></p>
<p>因為此 Script 是針對 Repo 來做處理，所以只要在任一個 Commit 上按右鍵即可<br>右鍵 → Custom Actions → Repository Actions → backupGitFolder</p>
<p><img src="14715714722480.gif" alt=""></p>
<p>執行完畢後，會出現在 Script 所設定的備份路徑</p>
<p><img src="14715716136420.jpg" alt=""></p>
<h1 id="還原-git"><a href="#還原-git" class="headerlink" title="還原 .git"></a>還原 .git</h1><h2 id="Script-1"><a href="#Script-1" class="headerlink" title="Script"></a>Script</h2><p>目的是將先前備份的 .git 還原回 product 裡</p>
<blockquote>
<p>測試一些指令後想把先前備份的 .git 還原回來</p>
</blockquote>
<p><strong>語法裡有使用 rm -rf 指令，請小心使用</strong><br><strong>語法裡有使用 rm -rf 指令，請小心使用</strong><br><strong>語法裡有使用 rm -rf 指令，請小心使用</strong></p>
<p>檔案路徑：~/SourceTree_Actions/restoreGitFolder.sh</p>
<p><code>$1 → 在 SourceTree 使用時，設定讓它帶入 repo path，為了區別不同 product 下的 .git</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">#!/bin/sh</div><div class="line"></div><div class="line"># 設定備份路徑</div><div class="line">backupPath=~/Downloads/backupGit/</div><div class="line"></div><div class="line"># 取得目錄名稱</div><div class="line">folderName=`basename $1`</div><div class="line"></div><div class="line"># 將目錄剛整路徑 MD5</div><div class="line">folderNameSHA=`md5 &lt;&lt;&lt; &quot;$1&quot;`</div><div class="line"></div><div class="line"># 組合備份目錄名稱</div><div class="line">backupFolderName=&quot;$&#123;folderName&#125;__$&#123;folderNameSHA&#125;__git&quot;</div><div class="line"></div><div class="line">rm -rf ./.git</div><div class="line">cp -rf $&#123;backupPath&#125;$&#123;backupFolderName&#125; ./.git</div></pre></td></tr></table></figure>
<h2 id="使用方式-1"><a href="#使用方式-1" class="headerlink" title="使用方式"></a>使用方式</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">建議再第一次使用時，先手動將 .git 備份出去，避免設定上出問題導至 .git 完全不見且沒備份到</div></pre></td></tr></table></figure>
<p>開啟設定介面 SourceTree → Preferences 或 快速鍵 <code>CMD + ,</code></p>
<p><img src="14715694646486.jpg" alt=""></p>
<p>切換至 Custom Actions<br>新增 Add</p>
<p><img src="14715718520080.jpg" alt=""></p>
<p>Menu Caption → <code>restoreGitFolder</code> (自訂)<br>Script to run → <code>bash</code> (使用 bash 來執行 script)<br>Parameters → <code>/SourceTree_Actions/restoreGitFolder.sh $REPO</code> script 路徑，且帶入參數 $REPO</p>
<p><img src="14715718938615.jpg" alt=""></p>
<p>新增完後會看到剛新增的項目</p>
<p><img src="14715719070371.jpg" alt=""></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">由於 SourceTree 會持續針測 Repo 的變化</div><div class="line">如果一樣在 Commit 上右鍵使用的話，線圖會一直報錯</div><div class="line">所以我會關閉這個 Repo 介面，直接在 Repo List 上使用</div><div class="line">如果電腦不快 或 Repo 較大，導至做還原動作時間超過 SourceTree 針測時間還是會報錯</div><div class="line">不過可以不理它....</div></pre></td></tr></table></figure>
<p>因為此 Script 是針對 Repo 來做處理，所以要在指定的 Repo 上按右鍵<br>右鍵 → Custom Actions → Repository Actions → restoreGitFolder</p>
<p><img src="14715724056407.gif" alt=""></p>
<p>這個是報錯的畫面，意思是找不到 git log</p>
<p><img src="14715730135810.jpg" alt=""></p>
<h1 id="差異打包"><a href="#差異打包" class="headerlink" title="差異打包"></a>差異打包</h1><h2 id="Script-2"><a href="#Script-2" class="headerlink" title="Script"></a>Script</h2><p>目日是將 HEAD 與某個 commit 做差異打包</p>
<blockquote>
<p>有時在功能完成後要放到其它環境下時，該環境可能不沒有 GIT，這時會需要做差異打包上傳</p>
</blockquote>
<p>檔案路徑：~/SourceTree_Actions/archiveCustomCommit.sh</p>
<p><code>$1 → 在 SourceTree 使用時，設定讓它帶入自行選擇的 Commit SHA</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line">#!/bin/sh</div><div class="line"></div><div class="line"># 取得現在日期時間</div><div class="line">dateStr=`date +%Y%m%d%H%M%S`</div><div class="line"></div><div class="line"># 設定打包檔案放置路徑</div><div class="line">archivePath=~/Downloads/</div><div class="line"></div><div class="line"># 取得目錄名稱</div><div class="line">folderName=`basename $1`</div><div class="line"></div><div class="line"># 查詢當下的 tags name 或 commit sha</div><div class="line">currentSHA=`git rev-parse --short HEAD`</div><div class="line">currentTag=`git show-ref --tags -d | grep ^$&#123;currentSHA&#125; | sed -e &apos;s,.* refs/tags/,,&apos; -e &apos;s/\^&#123;&#125;//&apos;`</div><div class="line">if [ &quot;$&#123;currentTag&#125;&quot; = &quot;&quot; ] || [ &quot;$&#123;currentTag&#125;&quot; = &quot;HEAD&quot; ]; then</div><div class="line">    currentTag=`git rev-parse --short &quot;$&#123;currentSHA&#125;&quot;`</div><div class="line">fi</div><div class="line"></div><div class="line"># 查詢選擇的 tags name 或 commit sha</div><div class="line">diffTag=`git show-ref --tags -d | grep ^&quot;$2&quot; | sed -e &apos;s,.* refs/tags/,,&apos; -e &apos;s/\^&#123;&#125;//&apos;`</div><div class="line">if [ &quot;$&#123;diffTag&#125;&quot; = &quot;&quot; ] || [ &quot;$&#123;diffTag&#125;&quot; = &quot;HEAD&quot; ]; then</div><div class="line">    diffTag=`git rev-parse --short &quot;$2&quot;`</div><div class="line">fi</div><div class="line"></div><div class="line"># 組合打包檔名</div><div class="line">archiveFileName=&quot;$&#123;folderName&#125;__$&#123;dateStr&#125;__$&#123;currentTag&#125;_Diff_$&#123;diffTag&#125;.zip&quot;</div><div class="line"></div><div class="line"># 進行打包</div><div class="line">git diff-tree -r --no-commit-id --name-only --diff-filter=ACMRT $&#123;diffTag&#125; $&#123;currentSHA&#125; | xargs zip $&#123;archivePath&#125;$&#123;archiveFileName&#125;</div></pre></td></tr></table></figure>
<h2 id="使用方式-2"><a href="#使用方式-2" class="headerlink" title="使用方式"></a>使用方式</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">建議再第一次使用時，先手動將 .git 備份出去，避免設定上出問題導至 .git 完全不見且沒備份到</div></pre></td></tr></table></figure>
<p>開啟設定介面 SourceTree → Preferences 或 快速鍵 <code>CMD + ,</code></p>
<p><img src="14715694646486.jpg" alt=""></p>
<p>切換至 Custom Actions<br>新增 Add</p>
<p><img src="14715733067241.jpg" alt=""></p>
<p>Menu Caption → <code>restoreGitFolder</code> (自訂)<br>Script to run → <code>bash</code> (使用 bash 來執行 script)<br>Parameters → <code>/SourceTree_Actions/archiveCustomCommit.sh $REPO $SHA</code> Script 路徑，且帶入參數 \$REPO、\$SHA</p>
<p><img src="14715733564409.jpg" alt=""></p>
<p>新增完後會看到剛新增的項目</p>
<p><img src="14715734899658.jpg" alt=""></p>
<p>因為此 Script 是針對 HEAD 與指定 Commit 來做處理，所以要在指定的 Commit 上按右鍵<br>右鍵 → Custom Actions → archiveCustomDiffCommit</p>
<p><img src="14715736612690.gif" alt=""></p>
<p>此範例是要將 ad1e0aa 與 b5fefac 兩個 Commit 的差異做打包<br>執行完後，會在指定的目錄下看到差異打包檔</p>
<p><img src="14715738069406.jpg" alt=""></p>
<p>如果 Commit 上是有 Tag 的話</p>
<p><img src="14715739635778.gif" alt=""></p>
<p>此範例是要將 ad1e0aa 與 b5fefac(TestTag) 兩個 Commit 的差異做打包<br>執行完後，會在指定的目錄下看到差異打包檔，並且使用 Tag 來當檔名</p>
<p><img src="14715740324043.jpg" alt=""></p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[在 CentOS 6 安裝、設定 Observium]]></title>
      <url>https://blog.dtask.idv.tw/CentOS/observium_installation_in_centos_6/</url>
      <content type="html"><![CDATA[<h1 id="Nginx"><a href="#Nginx" class="headerlink" title="Nginx"></a>Nginx</h1><h2 id="建立-Nginx-Repo-設定檔"><a href="#建立-Nginx-Repo-設定檔" class="headerlink" title="建立 Nginx Repo 設定檔"></a>建立 Nginx Repo 設定檔</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">vi /etc/yum.repos.d/nginx.repo</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">[nginx]</div><div class="line">name=nginx repo</div><div class="line">baseurl=http://nginx.org/packages/mainline/centos/6/$basearch/</div><div class="line">gpgcheck=0</div><div class="line">enabled=1</div></pre></td></tr></table></figure>
<h2 id="安裝-Nginx"><a href="#安裝-Nginx" class="headerlink" title="安裝 Nginx"></a>安裝 Nginx</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">yum install nginx -y</div><div class="line">chkconfig nginx on</div><div class="line">service nginx start</div></pre></td></tr></table></figure>
<a id="more"></a>
<h1 id="MariaDB"><a href="#MariaDB" class="headerlink" title="MariaDB"></a>MariaDB</h1><h2 id="先建立MariaDB-repo檔"><a href="#先建立MariaDB-repo檔" class="headerlink" title="先建立MariaDB repo檔"></a>先建立MariaDB repo檔</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">vi /etc/yum.repos.d/MariaDB.repo</div></pre></td></tr></table></figure>
<h3 id="MariaDB-5-5"><a href="#MariaDB-5-5" class="headerlink" title="MariaDB 5.5"></a>MariaDB 5.5</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">#MariaDB 5.5 CentOS repository list</div><div class="line">#http://mariadb.org/mariadb/repositories/</div><div class="line">[mariadb]</div><div class="line">name=MariaDB</div><div class="line">baseurl=http://yum.mariadb.org/5.5/centos6-amd64</div><div class="line">gpgkey=https://yum.mariadb.org/RPM-GPG-KEY-MariaDB</div><div class="line">gpgcheck=1</div></pre></td></tr></table></figure>
<h3 id="MariaDB-10-1-19"><a href="#MariaDB-10-1-19" class="headerlink" title="MariaDB 10.1.19"></a>MariaDB 10.1.19</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">#MariaDB 10.1.19 CentOS repository list</div><div class="line">#http://mariadb.org/mariadb/repositories/</div><div class="line">[mariadb]</div><div class="line">name=MariaDB</div><div class="line">baseurl=http://yum.mariadb.org/10.1.9/centos6-amd64</div><div class="line">gpgkey=https://yum.mariadb.org/RPM-GPG-KEY-MariaDB</div><div class="line">gpgcheck=1</div></pre></td></tr></table></figure>
<h2 id="安裝-MariabDB"><a href="#安裝-MariabDB" class="headerlink" title="安裝 MariabDB"></a>安裝 MariabDB</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">yum install MariaDB-client MariaDB-server -y</div><div class="line">service mysql start</div><div class="line">chkconfig mysql on</div></pre></td></tr></table></figure>
<h2 id="初始化-MariabDB"><a href="#初始化-MariabDB" class="headerlink" title="初始化 MariabDB"></a>初始化 MariabDB</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">/usr/bin/mysql_secure_installation</div></pre></td></tr></table></figure>
<h2 id="建立-MariabDB-帳號"><a href="#建立-MariabDB-帳號" class="headerlink" title="建立 MariabDB 帳號"></a>建立 MariabDB 帳號</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">/usr/bin/mysql -u root -p</div><div class="line">grant all on *.* to [user]@&apos;%&apos; identified by &apos;[password]&apos; with grant option;</div><div class="line">flush privileges;</div></pre></td></tr></table></figure>
<h1 id="PHP"><a href="#PHP" class="headerlink" title="PHP"></a>PHP</h1><h2 id="安裝-PHP"><a href="#安裝-PHP" class="headerlink" title="安裝 PHP"></a>安裝 PHP</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">yum --enablerepo=remi install php php-mysql php-gd php-posix php-mcrypt \</div><div class="line">php-pear php-fpm vixie-cron net-snmp net-snmp-utils fping MySQL-python rrdtool \</div><div class="line">subversion jwhois ipmitool graphviz ImageMagick libvirt -y</div></pre></td></tr></table></figure>
<h2 id="修改-php-ini"><a href="#修改-php-ini" class="headerlink" title="修改 php.ini"></a>修改 php.ini</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">vi /etc/php.ini</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">cgi.fix_pathinfo=1</div><div class="line">↓</div><div class="line">cgi.fix_pathinfo=0</div></pre></td></tr></table></figure>
<h2 id="啟動PHP-FPM服務"><a href="#啟動PHP-FPM服務" class="headerlink" title="啟動PHP-FPM服務"></a>啟動PHP-FPM服務</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">service php-fpm start</div><div class="line">chkconfig php-fpm on</div></pre></td></tr></table></figure>
<h2 id="配置-Nginx-設定"><a href="#配置-Nginx-設定" class="headerlink" title="配置 Nginx 設定"></a>配置 Nginx 設定</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">vi /etc/nginx/nginx.conf</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line">user nginx;</div><div class="line">worker_processes 4;</div><div class="line">worker_cpu_affinity 0001 0010 0100 1000;</div><div class="line">worker_rlimit_nofile 1024;</div><div class="line">pid /var/run/nginx.pid;</div><div class="line"> </div><div class="line">events &#123;</div><div class="line">    use epoll;</div><div class="line">    worker_connections 2048;</div><div class="line">&#125;</div><div class="line"> </div><div class="line">http &#123;</div><div class="line">    sendfile on;</div><div class="line">    tcp_nopush on;</div><div class="line">    tcp_nodelay on;</div><div class="line">    keepalive_timeout 65;</div><div class="line">    types_hash_max_size 2048;</div><div class="line">    server_names_hash_bucket_size 128;</div><div class="line"> </div><div class="line">    include /etc/nginx/mime.types;</div><div class="line">    default_type application/octet-stream;</div><div class="line"> </div><div class="line">    client_header_buffer_size 2k;</div><div class="line">    large_client_header_buffers 4 4k;</div><div class="line">    open_file_cache max=102400 inactive=20s;</div><div class="line">    </div><div class="line">    log_format  main  &apos;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &apos;</div><div class="line">                      &apos;$status $body_bytes_sent &quot;$http_referer&quot; &apos;</div><div class="line">                      &apos;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&apos;;</div><div class="line">  </div><div class="line">    access_log /var/log/nginx/access.log;</div><div class="line">    error_log /var/log/nginx/error.log;</div><div class="line"> </div><div class="line">    gzip on;</div><div class="line">    gzip_disable &quot;msie6&quot;;</div><div class="line"> </div><div class="line">    include /etc/nginx/conf.d/*.conf;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="Observium"><a href="#Observium" class="headerlink" title="Observium"></a>Observium</h1><h2 id="建立-Observium-要用的-DB-帳號"><a href="#建立-Observium-要用的-DB-帳號" class="headerlink" title="建立 Observium 要用的 DB 帳號"></a>建立 Observium 要用的 DB 帳號</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mysql -u root -p</div></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">CREATE</span> <span class="keyword">DATABASE</span> observium <span class="keyword">DEFAULT</span> <span class="built_in">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_general_ci;</div><div class="line"><span class="keyword">GRANT</span> ALL <span class="keyword">PRIVILEGES</span> <span class="keyword">ON</span> observium.* <span class="keyword">TO</span> <span class="string">'observium'</span>@<span class="string">'localhost'</span> <span class="keyword">IDENTIFIED</span> <span class="keyword">BY</span> <span class="string">'observium'</span>;</div><div class="line"><span class="keyword">flush</span> <span class="keyword">privileges</span>;</div></pre></td></tr></table></figure>
<h2 id="下載-Observium"><a href="#下載-Observium" class="headerlink" title="下載 Observium"></a>下載 Observium</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">cd /opt</div><div class="line">mkdir -p /opt/observium</div><div class="line">wget http://www.observium.org/observium-community-latest.tar.gz</div><div class="line">tar -zxvf observium-community-latest.tar.gz</div></pre></td></tr></table></figure>
<h2 id="安裝-Observium"><a href="#安裝-Observium" class="headerlink" title="安裝 Observium"></a>安裝 Observium</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">cd observium</div><div class="line">cp config.php.default config.php</div></pre></td></tr></table></figure>
<h3 id="設定-config-php"><a href="#設定-config-php" class="headerlink" title="設定 config.php"></a>設定 config.php</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">vi config.php</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"># 修改 db username, password</div><div class="line">$config[&apos;db_user&apos;] = &apos;observium&apos;;</div><div class="line">$config[&apos;db_pass&apos;] = &apos;observium&apos;;</div><div class="line"></div><div class="line"># 新增設定</div><div class="line">$config[&apos;geocoding&apos;][&apos;enable&apos;] = TRUE;</div><div class="line">$config[&apos;geocoding&apos;][&apos;api&apos;] = &apos;mapquest&apos;;</div><div class="line">$config[&apos;fping&apos;] = &quot;/usr/sbin/fping&quot;;</div></pre></td></tr></table></figure>
<h3 id="安裝-Observium-資料表"><a href="#安裝-Observium-資料表" class="headerlink" title="安裝 Observium 資料表"></a>安裝 Observium 資料表</h3><blockquote>
<p>可能要執行兩次</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">/opt/observium/discovery.php -u</div></pre></td></tr></table></figure>
<h3 id="建立-logs-以及-rrd-的目錄"><a href="#建立-logs-以及-rrd-的目錄" class="headerlink" title="建立 logs 以及 rrd 的目錄"></a>建立 logs 以及 rrd 的目錄</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"># log dir</div><div class="line">mkdir /opt/observium/logs</div><div class="line">chown apache:apache /opt/observium/logs</div><div class="line"></div><div class="line"># rrd dir</div><div class="line">mkdir /opt/observium/rrd</div><div class="line">chown apache:apache /opt/observium/rrd</div></pre></td></tr></table></figure>
<h3 id="設定-observium-虛擬網站的網頁目錄"><a href="#設定-observium-虛擬網站的網頁目錄" class="headerlink" title="設定 observium 虛擬網站的網頁目錄"></a>設定 observium 虛擬網站的網頁目錄</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">vi /etc/nginx/conf.d/default.conf</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line">#</div><div class="line"># The default server</div><div class="line">#</div><div class="line">server &#123;</div><div class="line">    listen       80;</div><div class="line">    server_name  [server name];</div><div class="line"></div><div class="line">    charset utf-8;</div><div class="line"></div><div class="line">    access_log /var/log/nginx/observium.access.log main;</div><div class="line">    error_log /var/log/nginx/observium.error.log warn;</div><div class="line">    </div><div class="line">    root   /opt/observium/html/;</div><div class="line"></div><div class="line">    location / &#123;</div><div class="line">        try_files $uri $uri/ /index.php?$args;</div><div class="line">        index index.php  index.html index.htm;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    # pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000</div><div class="line">    #</div><div class="line">    location ~ \.php$ &#123;</div><div class="line">        fastcgi_pass   127.0.0.1:9000;</div><div class="line">        fastcgi_index  index.php;</div><div class="line">        fastcgi_param  SCRIPT_FILENAME   $document_root$fastcgi_script_name;</div><div class="line">        include        fastcgi_params;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    gzip on;</div><div class="line">    gzip_min_length 1k;</div><div class="line">    gzip_buffers 4 16k;</div><div class="line">    gzip_http_version 1.1;</div><div class="line">    gzip_comp_level 2;</div><div class="line">    gzip_types text/plain application/x-javascript text/css application/xml text/javascript application/x-httpd-php image/jpeg image/gif image/png;</div><div class="line">    gzip_vary on;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="建立帳號，level-10-是-admin"><a href="#建立帳號，level-10-是-admin" class="headerlink" title="建立帳號，level 10 是 admin"></a>建立帳號，level 10 是 admin</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">/opt/observium/adduser.php admin [password] 10</div></pre></td></tr></table></figure>
<h3 id="調整-cronjob"><a href="#調整-cronjob" class="headerlink" title="調整 cronjob"></a>調整 cronjob</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">crontab -e</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">33 */6 * * * /opt/observium/discovery.php -h all &gt;&gt; /dev/null 2&gt;&amp;1</div><div class="line">*/5 * * * * /opt/observium/discovery.php -h new &gt;&gt; /dev/null 2&gt;&amp;1</div><div class="line">*/5 * * * * /opt/observium/poller-wrapper.py 2 &gt;&gt; /dev/null 2&gt;&amp;1</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">/etc/init.d/crond reload</div></pre></td></tr></table></figure>
<h1 id="新增監控主機"><a href="#新增監控主機" class="headerlink" title="新增監控主機"></a>新增監控主機</h1><blockquote>
<p>Observium 不接受 IP，所要被被監控主機的IP要先去 /etc/hosts 設定假的 Domain</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">vi /etc/hosts</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">/opt/observium/add_device.php [hostname] public v2c</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">/opt/observium/discovery.php -h all</div><div class="line">/opt/observium/poller.php -h all</div></pre></td></tr></table></figure>
<h1 id="被監控主機安裝-SNMP"><a href="#被監控主機安裝-SNMP" class="headerlink" title="被監控主機安裝 SNMP"></a>被監控主機安裝 SNMP</h1><h2 id="Centos-安裝、設定-SNMP"><a href="#Centos-安裝、設定-SNMP" class="headerlink" title="Centos 安裝、設定 SNMP"></a>Centos 安裝、設定 SNMP</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">yum install net-snmp net-snmp-utils -y</div><div class="line">chkconfig snmpd on</div><div class="line">service snmpd start</div></pre></td></tr></table></figure>
<h3 id="測試"><a href="#測試" class="headerlink" title="測試"></a>測試</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">snmpwalk -c public -v 1 localhost system</div></pre></td></tr></table></figure>
<h3 id="設定-SNMP"><a href="#設定-SNMP" class="headerlink" title="設定 SNMP"></a>設定 SNMP</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">cp /etc/snmp/snmpd.conf /etc/snmp/snmpd.conf.orig</div><div class="line">vi /etc/snmp/snmpd.conf</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line">####</div><div class="line"># First, map the community name &quot;public&quot; into a &quot;security name&quot;</div><div class="line"></div><div class="line">#       sec.name  source           community</div><div class="line">com2sec local     localhost        public</div><div class="line">com2sec mynetwork [允許IP]/32       [自訂名稱]</div><div class="line"></div><div class="line">####</div><div class="line"># Second, map the security name into a group name:</div><div class="line"></div><div class="line">#       groupName      securityModel securityName</div><div class="line">group   MyRWGroup      any           local</div><div class="line">group   MyROGroup      v2c           mynetwork</div><div class="line"></div><div class="line">####</div><div class="line"># Third, create a view for us to let the group have rights to:</div><div class="line"></div><div class="line"># Make at least  snmpwalk -v 1 localhost -c public system fast again.</div><div class="line">#       name           incl/excl     subtree              mask(optional)</div><div class="line">view    all            included      .1                   80</div><div class="line"></div><div class="line">####</div><div class="line"># Finally, grant the group read-only access to the systemview view.</div><div class="line"></div><div class="line">#       group          context sec.model sec.level prefix read write  notif</div><div class="line">access  MyRWGroup      &quot;&quot;      any       noauth    0      all  all    all</div><div class="line">access  MyROGroup      &quot;&quot;      any       noauth    0      all  none   none</div><div class="line"></div><div class="line">syslocation Taiwan</div><div class="line"></div><div class="line">disk / 10000</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">service snmpd restart</div></pre></td></tr></table></figure>
<h2 id="開啟-UDP-161-Port"><a href="#開啟-UDP-161-Port" class="headerlink" title="開啟 UDP 161 Port"></a>開啟 UDP 161 Port</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">vi /etc/sysconfig/iptables</div><div class="line">-A INPUT -m state --state NEW -m udp -p udp -s [Observium Server IP] --dport 161 -j ACCEPT</div><div class="line">service iptables restart</div></pre></td></tr></table></figure>
<h2 id="測試-1"><a href="#測試-1" class="headerlink" title="測試"></a>測試</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">snmpget -v 1 -c &quot;public&quot; localhost .1.3.6.1.4.1.2021.9.1.2.1</div><div class="line"># UCD-SNMP-MIB::dskPath.1 = STRING: /</div><div class="line"></div><div class="line">snmpget -v 1 -c &quot;public&quot; localhost .1.3.6.1.4.1.2021.9.1.3.1</div><div class="line"># UCD-SNMP-MIB::dskDevice.1 = STRING: /dev/mapper/VolGroup-lv_root</div><div class="line"></div><div class="line">snmpget -v 1 -c &quot;public&quot; localhost .1.3.6.1.4.1.2021.4.5.0 </div><div class="line"># UCD-SNMP-MIB::memTotalReal.0 = INTEGER: 3973956 kB</div></pre></td></tr></table></figure>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[MySQL(Maria) Master Slave Replication]]></title>
      <url>https://blog.dtask.idv.tw/MySQL/mysql_master_slave_replication/</url>
      <content type="html"><![CDATA[<h1 id="主機A-Master"><a href="#主機A-Master" class="headerlink" title="主機A (Master)"></a>主機A (Master)</h1><h2 id="Mater-my-cnf-設定"><a href="#Mater-my-cnf-設定" class="headerlink" title="Mater my.cnf 設定"></a>Mater my.cnf 設定</h2><p>在 [mysqld] 底下設定參數</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">[mysqld]</div><div class="line"># 主機 1</div><div class="line">server-id=1</div><div class="line"></div><div class="line"># 要同步的Database (可多個)</div><div class="line">binlog-do-db=[DB Name]</div><div class="line"></div><div class="line"># Binary log 只保留三天</div><div class="line">expire_logs_days=3</div><div class="line"></div><div class="line"># Log</div><div class="line">relay-log=/var/lib/mysql/mysql-relay-bin</div><div class="line">relay-log-index=/var/lib/mysql/mysql-relay-bin.index</div><div class="line">log-error=/var/lib/mysql/mysql.err</div><div class="line">master-info-file=/var/lib/mysql/mysql-master.info</div><div class="line">relay-log-info-file=/var/lib/mysql/mysql-relay-log.info</div><div class="line">log-bin=/var/lib/mysql/mysql-bin</div></pre></td></tr></table></figure>
<a id="more"></a>
<h2 id="進入-DB-設定"><a href="#進入-DB-設定" class="headerlink" title="進入 DB 設定"></a>進入 DB 設定</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mysql -u root -p</div></pre></td></tr></table></figure>
<h3 id="建立要讓-Slave-連線的帳號"><a href="#建立要讓-Slave-連線的帳號" class="headerlink" title="建立要讓 Slave 連線的帳號"></a>建立要讓 Slave 連線的帳號</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">GRANT REPLICATION SLAVE ON *.* TO &apos;slave_user&apos;@&apos;%&apos; IDENTIFIED BY &apos;password&apos;;</div><div class="line">FLUSH PRIVILEGES;</div><div class="line">FLUSH TABLES WITH READ LOCK;</div></pre></td></tr></table></figure>
<h3 id="查詢-Master-狀態"><a href="#查詢-Master-狀態" class="headerlink" title="查詢 Master 狀態"></a>查詢 Master 狀態</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">show master status;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">+------------------+----------+----------------+------------------+</div><div class="line">| File             | Position | Binlog_Do_DB   | Binlog_Ignore_DB |</div><div class="line">+------------------+----------+----------------+------------------+</div><div class="line">| mysql-bin.000001 |      832 | [DB Name]      |                  |</div><div class="line">+------------------+----------+----------------+------------------+</div><div class="line">1 row in set (0.00 sec)</div></pre></td></tr></table></figure>
<p>記下 File、Position，要設定到 Slave 主機</p>
<h1 id="主機B-Slave"><a href="#主機B-Slave" class="headerlink" title="主機B (Slave)"></a>主機B (Slave)</h1><h2 id="Mater-my-cnf-設定-1"><a href="#Mater-my-cnf-設定-1" class="headerlink" title="Mater my.cnf 設定"></a>Mater my.cnf 設定</h2><p>在 [mysqld] 底下設定參數</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">[mysqld]</div><div class="line"># 主機 2</div><div class="line">server-id=2</div><div class="line"></div><div class="line"># 要同步的Database (可多個)</div><div class="line">replicate-do-db=[DB Name]</div><div class="line"></div><div class="line"># Binary log 只保留三天</div><div class="line">expire_logs_days=3</div><div class="line"></div><div class="line"># Log</div><div class="line">relay-log=/var/lib/mysql/mysql-relay-bin</div><div class="line">relay-log-index=/var/lib/mysql/mysql-relay-bin.index</div><div class="line">log-error=/var/lib/mysql/mysql.err</div><div class="line">master-info-file=/var/lib/mysql/mysql-master.info</div><div class="line">relay-log-info-file=/var/lib/mysql/mysql-relay-log.info</div><div class="line">log-bin=/var/lib/mysql/mysql-bin</div></pre></td></tr></table></figure>
<h2 id="進入-DB-設定-1"><a href="#進入-DB-設定-1" class="headerlink" title="進入 DB 設定"></a>進入 DB 設定</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mysql -u root -p</div></pre></td></tr></table></figure>
<h3 id="停止-Slave"><a href="#停止-Slave" class="headerlink" title="停止 Slave"></a>停止 Slave</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">stop slave;</div></pre></td></tr></table></figure>
<h3 id="設定-Slave"><a href="#設定-Slave" class="headerlink" title="設定 Slave"></a>設定 Slave</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">CHANGE MASTER TO MASTER_HOST=&apos;[MasterIP]&apos;, MASTER_USER=&apos;[MasterUser]&apos;, MASTER_PASSWORD=&apos;[MasterPassword]&apos;, MASTER_LOG_FILE=&apos;[MasterLogFullFile]&apos;, MASTER_LOG_POS=[MasterPosition];</div></pre></td></tr></table></figure>
<h3 id="開啟-Slave"><a href="#開啟-Slave" class="headerlink" title="開啟 Slave"></a>開啟 Slave</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">start slave;</div></pre></td></tr></table></figure>
<h3 id="查詢-Slave-狀態"><a href="#查詢-Slave-狀態" class="headerlink" title="查詢 Slave 狀態"></a>查詢 Slave 狀態</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">show slave status \G;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div></pre></td><td class="code"><pre><div class="line">*************************** 1. row ***************************</div><div class="line">               Slave_IO_State:</div><div class="line">                  Master_Host: [Master Host IP]</div><div class="line">                  Master_User: slave_user</div><div class="line">                  Master_Port: 3306</div><div class="line">                Connect_Retry: 60</div><div class="line">              Master_Log_File: mysql-bin.000001</div><div class="line">          Read_Master_Log_Pos: 545</div><div class="line">               Relay_Log_File: mysql-relay-bin.000002</div><div class="line">                Relay_Log_Pos: 769</div><div class="line">        Relay_Master_Log_File: mysql-bin.000001</div><div class="line">             Slave_IO_Running: Yes</div><div class="line">            Slave_SQL_Running: Yes</div><div class="line">              Replicate_Do_DB: [DB Name]</div><div class="line">          Replicate_Ignore_DB:</div><div class="line">           Replicate_Do_Table:</div><div class="line">       Replicate_Ignore_Table:</div><div class="line">      Replicate_Wild_Do_Table:</div><div class="line">  Replicate_Wild_Ignore_Table:</div><div class="line">                   Last_Errno: 0</div><div class="line">                   Last_Error:</div><div class="line">                 Skip_Counter: 0</div><div class="line">          Exec_Master_Log_Pos: 545</div><div class="line">              Relay_Log_Space: 1067</div><div class="line">              Until_Condition: None</div><div class="line">               Until_Log_File:</div><div class="line">                Until_Log_Pos: 0</div><div class="line">           Master_SSL_Allowed: No</div><div class="line">           Master_SSL_CA_File:</div><div class="line">           Master_SSL_CA_Path:</div><div class="line">              Master_SSL_Cert:</div><div class="line">            Master_SSL_Cipher:</div><div class="line">               Master_SSL_Key:</div><div class="line">        Seconds_Behind_Master: NULL</div><div class="line">Master_SSL_Verify_Server_Cert: No</div><div class="line">                Last_IO_Errno: 0</div><div class="line">                Last_IO_Error:</div><div class="line">               Last_SQL_Errno: 0</div><div class="line">               Last_SQL_Error:</div><div class="line">  Replicate_Ignore_Server_Ids:</div><div class="line">             Master_Server_Id: 1</div><div class="line">               Master_SSL_Crl:</div><div class="line">           Master_SSL_Crlpath:</div><div class="line">                   Using_Gtid: No</div><div class="line">                  Gtid_IO_Pos:</div><div class="line">      Replicate_Do_Domain_Ids:</div><div class="line">  Replicate_Ignore_Domain_Ids:</div><div class="line">                Parallel_Mode: conservative</div><div class="line">1 row in set (0.00 sec)</div></pre></td></tr></table></figure>
<p>Slave_IO_Running、Slave_SQL_Running 需為 Yes 才是正常</p>
<h1 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h1><p>當 Master or Slave 有做重啟動作時，需回到 Slave 查看 Slave 狀態</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">show slave status \G;</div></pre></td></tr></table></figure>
]]></content>
    </entry>
    
  
  
</search>
